<!DOCTYPE html>
<html lang="ko"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layouts/adminLayout.html}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LotteOn::Admin</title>
    <link rel="stylesheet" th:href="@{/css/admin/shoplistmodal.css}">
    <link rel="stylesheet" th:href="@{/css/admin/admin_delivery_modal.css}">
    <link rel="stylesheet" th:href="@{/css/admin/admin-modal.css}">
    <link rel="stylesheet"  th:href="@{/css/admin/adminOrder.css}">

</head>
<body>
<th:block layout:fragment="content">
            <div id="admin_service">
                <section>
                    <th:block th:replace="~{content/admin/admin_gate}"></th:block>
                    <section id="admin_navi">
                        <p>주문현황</p>
                        <p><a href="#">HOME</a> > 주문관리 > 주문현황</p>
                     </section>
              
                <article id="admin_order_main">
                    <div>
                        <select id="ordersearch"  name="type">
                            <option value="orderNumber">주문번호</option>
                            <option value="orderUid">주문자</option>
                            <option value="orderName">주문자명</option>
                        </select>
                        <input id="search" type="text" name="keyword" placeholder="검색어 입력">
                        <button id="searchBtn" type="button">검색</button>
                    </div>
                    <table class="admin_order_table">
                        <colgroup>
                            <col style="width: 14%">
                            <col style="width: 8%">
                            <col style="width: 8%">
                            <col style="width: 12%">
                            <col style="width: 6%">
                            <col style="width: 10%">
                            <col style="width: 8%">
                            <col style="width: 8%">
                            <col style="width: 17%">
                            <col style="width: 9%">
                        </colgroup>
                        <thead>
                        <tr>
                            <th>주문번호</th>
                            <th>주문자</th>
                            <th>주문자명</th>
                            <th>상품명</th>
                            <th>주문건수</th>
                            <th>주문합계</th>
                            <th>결제수단</th>
                            <th>주문상태</th>
                            <th>주문일</th>
                            <th>배송</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr th:each="order, i:${adminOrderPageResponseDTO.getAdminorderdtoList()}">
                            <td><a class="order-modal-btn" th:text="${order.orderId}">10101212121</a></td>
                            <td th:text="${order.uid}">wlgus5946</td>
                            <td th:text="${order.memberName}">챱챱김</td>
                            <td class="productname" th:text="${order.orderItems[0].product.productName + '(외)'}">초코틴틴</td>
                            <td th:text="${order.totalQuantity}">896</td>
                            <td th:text="${order.totalPrice}">9,000</td>
                            <td th:text="${order.pay}">신용카드</td>
                            <td class="orderstatus" th:text="${order.orderStatus}">결제완료</td>
                            <td th:text="${#strings.substring(order.orderDate,0,10)}"></td>
                            <td><button class="openModalBtn">배송하기</button></td>
                        </tr>
                        </tbody>
                    </table>
                </article>
                    <!-- 페이지네이션 컨테이너 -->
                    <div class="pagination">
                        <th:block th:if="${adminOrderPageResponseDTO.prev}">
                            <a th:href="@{/seller/order/status(pg=${adminOrderPageResponseDTO.start - 1})}" class="prev">이전</a>
                        </th:block>

                        <th:block th:each="num : ${#numbers.sequence(adminOrderPageResponseDTO.start, adminOrderPageResponseDTO.end)}">
                            <a th:href="@{/seller/order/status(pg=${num})}"
                               th:class="${num == adminOrderPageResponseDTO.pg} ? 'qnacurrent' : 'qnanum'">[[${num}]]</a>
                        </th:block>

                        <th:block th:if="${adminOrderPageResponseDTO.next}">
                            <a th:href="@{/seller/order/status(pg=${adminOrderPageResponseDTO.end + 1})}" class="next">다음</a>
                        </th:block>
                    </div>

            <div id="productModal" class="modal">
                <div class="modal-content">
                    <div class="header">
                    <span class="close">&times;</span>
                    <h3>배송입력</h3>
                    </div>
                    <form>
                        <table class="modaltable">
                            <tr>
                                <th><label for="orderNo">주문번호</label></th>
                                <td>
                                    <input type="text" id="orderNo" name="orderNo" placeholder="123456" readonly>
                                </td>
                            </tr>
                            <tr>
                                <th><label for="recipient">수령인</label></th>
                                <td>
                                    <input type="recipient" id="recipient" name="recipient" placeholder="홍길동" readonly>
                                </td>
                            </tr>
                            <tr>
                                <th><label for="zipcode">주소</label></th>
                                <td>
                                    <input type="text" id="zipcode" placeholder="유저우편번호" readonly><br>
                                    <input type="text" id="address1" placeholder="유저기본주소" readonly><br>
                                    <input type="text" id="address2" placeholder="유저상세주소" readonly>
                                </td>
                            </tr>
                           
            
                            <tr>
                                <th><label for="courier">택배사</label></th>
                                <td> <select id="classification" >
                                    <option value="">택배사선택</option>
                                    <option value="">대한통운</option>
                                    <option value="">로젠택배</option>
                                    <option value="">우체국</option>
                                </select><br>
                                </td>
                            </tr>
                            <tr>
                                <th><label for="ownerName">운송장번호</label></th>
                                <td><input type="text" id="ownerName" name="ownerName" placeholder=""><br></td>
                            </tr>
                            <tr>
                                <th><label for="businessNumber">기타</label></th>
                                <td><textarea name="etc" id="etc" placeholder="유저요청사항" readonly></textarea><br></td>
                            </tr>
                            
                         </table>
                        <button type="submit">등록하기</button>
                    </form>
                </div>
            </div>
                    <section class="modal-section">
                        <div id="order-modal" class="order-modal">
                            <div class="order-items">
                                <span class="order-close" style="cursor: pointer;">&times;</span>
                                <h3>주문상세</h3>
                            </div>
                            <div class="modal-main">
                                <div class="order-details">
                                    <div class="product-info">
                                        <h3>상품정보</h3>
                                        <div class="">
                                            <div class="pro-details">
                                                <div class="pro-img"></div>
                                                <div class="pro-num">제품번호</div>
                                                <div class="pro-name">상품명</div>
                                                <div class="pro-seller">판매자</div>
                                                <div class="pro-price">가격</div>
                                                <div class="pro-sell">할인</div>
                                                <div class="pro-stock">재고</div>
                                                <div class="pro-ship">배송비</div>
                                                <div class="total-pay">결제금액</div>
                                            </div>
                                            <div class="details">
                                                <div class="pro-img-details">
                                                    <img src="../images/sample/화면 캡처 2024-10-17 102744.png" alt="#">
                                                </div>
                                                <div class="pro-num-details">123456789</div>
                                                <div class="pro-name-details">프리미엄 퀄리티 오가닉 코튼 100% 에코백 - 다용도 사용 가능, 강력한 내구성</div>
                                                <div class="pro-seller-details">뭐지</div>
                                                <div class="pro-price-details">뭐지</div>
                                                <div class="pro-sell-details">뭐지</div>
                                                <div class="pro-stock-details">뭐지</div>
                                                <div class="pro-ship-details">5000원</div>
                                                <div class="total-pay-details">뭐지</div>
                                            </div>
                                        </div>
                                        <div class="total-price">
                                            <div class="pay-title">
                                                <h3>결제정보</h3>
                                            </div>

                                            <div class="total-info">
                                                <div class="total-item">
                                                    <div>총 상품금액</div>
                                                    <div class="price">1234원</div>
                                                </div>
                                                <div class="total-item">
                                                    <div>총 할인금액</div>
                                                    <div class="price">34원</div>
                                                </div>
                                                <div class="total-item">
                                                    <div>배송비</div>
                                                    <div class="price">1000원</div>
                                                </div>
                                                <div class="total-item">
                                                    <div>총 결제금액</div>
                                                    <div>20000원</div>
                                                </div>
                                            </div>

                                        </div>

                                    </div>

                                    <div class="pay-info">
                                        <div class="payment-flex">
                                            <div class="payment-info">
                                                <div class="pay-id">주문번호</div>
                                                <div class="payment">결제방법</div>
                                                <div class="pay-user">주문자 / 연락처</div>
                                                <div class="pay-total">결제상태</div>
                                            </div>
                                            <div class="payment-details">
                                                <div class="pay-id-details">주문번호</div>
                                                <div class="pay-details">결제방법</div>
                                                <div class="pay-user-details">주문자 / 연락처</div>
                                                <div class="pay-total-details">결제완료
                                                    <span class="total-amount">총 결제금액</span>
                                                    <span class="price">200000000원</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="shipping">
                                        <h3>배송정보</h3>
                                        <div class="shipping-flex">
                                            <div class="user-info">
                                                <div class="user">수취인</div>
                                                <div class="user-hp">연락처</div>
                                                <div class="user-addr">배송지 주소</div>
                                            </div>
                                            <div class="user-details">
                                                <div class="user-name-details">수취인수취인수취인</div>
                                                <div class="user-hp-details">연락처수취인수취인</div>
                                                <div class="user-addr-details">배송지 주소수취인수취인</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </section>
<!--                    <script th:src="@{/js/delivery.js}"></script>-->
<!--<script>-->
<!--    // document.addEventListener("DOMContentLoaded", function() {-->
<!--    //     const orderitemId = document.querySelectorAll(".productname");-->
<!--    //-->
<!--    //     orderitemId.forEach(orderItems => {-->
<!--    //         const orderitem = orderItems.dataset.orderId;-->
<!--    //         const orderstatuses = document.querySelectorAll(".orderstatus");-->
<!--    //-->
<!--    //         fetch(`/seller/order/status/orderItem?orderId=${orderitem}`)-->
<!--    //             .then(resp => resp.json())-->
<!--    //             .then(orderItemDTO => {-->
<!--    //                 console.log("야...옹 :", orderItemDTO);-->
<!--    //                 console.log("메멩ㅇ..옹..:" + orderItemDTO.product.productName);-->
<!--    //                 orderItems.textContent = orderItemDTO.product.productName;-->
<!--    //-->
<!--    //-->
<!--    //                 orderstatuses.forEach(orderstatus => {-->
<!--    //                     orderstatus.textContent = orderItemDTO.status;-->
<!--    //                 });-->
<!--    //             })-->
<!--    //             .catch(err => {-->
<!--    //                 console.log(err);-->
<!--    //             });-->
<!--    //     })-->
<!--    //-->
<!--    // })-->

<!--</script>-->

                    <script>
                        document.addEventListener('DOMContentLoaded', function () {
                            const modal = document.querySelector('.modal-section');
                            const orderModal = document.querySelector('.order-items');
                            const modalClose = document.querySelector('.order-close');

                            function openModal() {
                                modal.style.display = 'flex'; // 모달을 flex로 표시
                                orderModal.style.display = 'block'; // 내부 모달도 표시
                            }

                            function closeModal() {
                                modal.style.display = 'none'; // 모달을 숨김
                                orderModal.style.display = 'none'; // 내부 모달도 숨김
                            }

                            document.querySelectorAll('.order-modal-btn').forEach(button => {
                                button.addEventListener('click', openModal);
                            });

                            modalClose.addEventListener('click', closeModal);

                            window.addEventListener('click', function (event) {
                                if (event.target === modal) {
                                    closeModal();
                                }
                            });




                            document.getElementById('searchBtn').addEventListener('click', function (e) {
                                e.preventDefault();
                                const type = document.getElementById('ordersearch').value;
                                const keyword = document.getElementById('search').value;

                                // 콘솔에 type과 keyword 값 출력
                                console.log('검색 기준 type:', type);
                                console.log('검색어 keyword:', keyword);

                                fetch(`/api/order/status/page?type=${type}&keyword=${keyword}`)
                                    .then(resp => resp.json())





                                    .then(adminOrderPageResponseDTO => {
                                        console.log("야옹 : "+ adminOrderPageResponseDTO);
                                        const ordertbody = document.querySelector('.admin_order_table tbody');
                                        ordertbody.innerHTML = '';
                                        adminOrderPageResponseDTO.adminorderdtoList.forEach(order => {
                                            const row = `
                                                <tr>
                                                    <td><a class="order-modal-btn" href="#">${order.orderId}</a></td>
                                                    <td>${order.uid}</td>
                                                    <td>${order.memberName}</td>
                                                    <td class="productname">${order.orderItems[0].product.productName} (외)</td>
                                                    <td>${order.totalQuantity}</td>
                                                    <td>${order.totalPrice}</td>
                                                    <td>${order.pay}</td>
                                                    <td class="orderstatus">${order.orderStatus}</td>
                                                    <td>${order.orderDate.substring(0, 10)}</td>
                                                    <td><button class="openModalBtn">배송하기</button></td>
                                                </tr>`;
                                            ordertbody.innerHTML += row;
                                        });
                                    })
                                    .catch(err => console.log(err));
                            });

                        });
                    </script>
</th:block>
